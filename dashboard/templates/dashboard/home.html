{% extends 'base.html' %}
{% load humanize %}

{% block title %}Home - Trading Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="gradient-text">Dashboard Overview</h1>
    <p class="text-muted">
        High-level summary of your multi-instrument strategy performance.
    </p>
</div>

<div class="dashboard-header">
    <div class="metrics-grid metrics-grid-5">
        <div class="metric-card">
            <div class="metric-label">Total Net Profit</div>
            <div class="metric-value">
                {% if combined_stats.Total_Net_Profit %}
                    ${{ combined_stats.Total_Net_Profit|floatformat:0|intcomma }}
                {% else %}
                    —
                {% endif %}
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Average Weekly Profit</div>
            <div class="metric-value">
                {% if avg_weekly_profit %}
                    ${{ avg_weekly_profit|floatformat:0|intcomma }}
                {% else %}
                    —
                {% endif %}
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Weeks Trading</div>
            <div class="metric-value">
                {% if weeks_trading %}
                    {{ weeks_trading|floatformat:1 }}
                {% else %}
                    —
                {% endif %}
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Total Trades</div>
            <div class="metric-value">
                {{ total_trades|default:"0" }}
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Instruments</div>
            <div class="metric-value">
                {{ selected_instruments|length }}
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>Equity Curve</h2>
    </div>
    <div class="card-body">
        {% if equity_curve_json != 'null' %}
            <div id="equityCurveChart" style="height: 360px;"></div>
            <script>
                (function() {
                    const data = {{ equity_curve_json|safe }};
                    const trace = {
                        x: data.x,
                        y: data.y,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#22c55e', width: 2 },
                        name: 'Equity'
                    };
                    const layout = {
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        margin: { t: 20, r: 20, b: 40, l: 60 },
                        xaxis: { title: 'Time' },
                        yaxis: { title: 'Cumulative Profit ($)' }
                    };
                    Plotly.newPlot('equityCurveChart', [trace], layout, {displaylogo: false});
                })();
            </script>
        {% else %}
            <p class="text-muted">
                No trade data available yet for the selected instruments and date range.
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}


